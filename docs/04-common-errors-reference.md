# Part 4: Common Errors Quick Reference

A comprehensive guide to all errors you might encounter when setting up a Turborepo monorepo with Tailwind CSS, shadcn/ui, and Prisma.

---

## Table of Contents
- [Workspace & Package Errors](#workspace--package-errors)
- [Import & Export Errors](#import--export-errors)
- [Tailwind & CSS Errors](#tailwind--css-errors)
- [Prisma & Database Errors](#prisma--database-errors)
- [Turbo Build Errors](#turbo-build-errors)
- [Production & Vercel Errors](#production--vercel-errors)

---

## Workspace & Package Errors

### ERR_PNPM_FETCH_404: Package Not Found in Registry

```
ERR_PNPM_FETCH_404  GET https://registry.npmjs.org/@repo%2Fui: Not Found - 404

This error happened while installing a direct dependency
@repo/ui is not in the npm registry, or you have no permission to fetch it.
```

**Cause:** Using `"*"` instead of `"workspace:*"` for local packages

**Wrong:**
```json
{
  "dependencies": {
    "@repo/ui": "*"
  }
}
```

**Correct:**
```json
{
  "dependencies": {
    "@repo/ui": "workspace:*"
  }
}
```

**Files to check:**
- `apps/main/package.json`
- `apps/admin/package.json`

---

### Workspace Protocol Not Recognized

```
error: Unsupported URL Type "workspace:": workspace:*
```

**Cause:** Using npm or yarn instead of pnpm

**Solution:** Use pnpm for monorepo:
```bash
# Install pnpm globally
npm install -g pnpm

# Then run
pnpm install
```

---

## Import & Export Errors

### Module Not Found: Can't Resolve Package Export

```
Module not found: Can't resolve '@repo/ui/components/ui/button'
```

**Cause 1:** Wrong exports pattern in package.json

```json
// ❌ WRONG
{
  "exports": {
    "./components/ui": "./src/components/ui/*.tsx"
  }
}

// ✅ CORRECT
{
  "exports": {
    "./components/ui/*": "./src/components/ui/*.tsx"
  }
}
```

**Cause 2:** File doesn't exist at the specified path

Check that `packages/ui/src/components/ui/button.tsx` exists.

---

### Module Not Found: Can't Resolve 'src/lib/utils'

```
Module not found: Can't resolve 'src/lib/utils'

Import trace:
./packages/ui/src/components/ui/button.tsx
```

**Cause:** shadcn generates components with non-standard imports

**Wrong (generated by shadcn):**
```typescript
import { cn } from "src/lib/utils"
```

**Correct:**
```typescript
import { cn } from "@repo/ui/lib/utils"
```

**Files to fix:**
- `packages/ui/src/components/ui/button.tsx`
- `packages/ui/src/components/ui/accordion.tsx`
- Any other shadcn component

---

### Module Not Found: Can't Resolve CSS File

```
Module not found: Can't resolve '@repo/ui/styles/globals.css'
```

**Cause:** Export path in package.json doesn't match import

**Check package.json exports:**
```json
// If importing: @repo/ui/styles/globals.css
// Then exports must have:
{
  "exports": {
    "./styles/globals.css": "./src/styles/globals.css"
  }
}
```

**Also check:** Does the file exist at `packages/ui/src/styles/globals.css`?

---

## Tailwind & CSS Errors

### Tailwind Classes Not Applied (No Styling)

**Cause 1:** Global CSS not imported

```tsx
// apps/main/app/layout.tsx
// ❌ Missing import
export default function RootLayout({ children }) {
  return <html><body>{children}</body></html>;
}

// ✅ Add import
import "@repo/ui/styles/globals.css";

export default function RootLayout({ children }) {
  return <html><body>{children}</body></html>;
}
```

**Cause 2:** Missing PostCSS config

```javascript
// apps/main/postcss.config.mjs
export default {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};
```

**Cause 3:** Missing Tailwind dependencies

```bash
pnpm add tailwindcss @tailwindcss/postcss postcss --filter main
```

---

### PostCSS Plugin Not Found

```
Error: Cannot find module '@tailwindcss/postcss'
```

**Solution:**
```bash
pnpm add @tailwindcss/postcss --filter main
pnpm add @tailwindcss/postcss --filter admin
```

---

## Prisma & Database Errors

### Prisma Schema Not Found

```
prisma:warn We could not find your Prisma schema in the default locations
If you have a Prisma schema file in a custom path, you will need to run
`prisma generate --schema=./path/to/your/schema.prisma`
```

**Cause:** Schema is in `packages/database/prisma/` but Prisma looks at root

**Solution:** Add to root package.json:

```json
{
  "prisma": {
    "schema": "./packages/database/prisma/schema.prisma"
  },
  "scripts": {
    "postinstall": "prisma generate --schema=./packages/database/prisma/schema.prisma"
  },
  "devDependencies": {
    "prisma": "6.14.0"
  }
}
```

---

### Cannot Find Module '@prisma/client'

```
Cannot find module '@prisma/client' or its corresponding type declarations.
```

**Cause 1:** Prisma client not generated

```bash
pnpm --filter @repo/database generate
```

**Cause 2:** Dependencies not installed

```bash
pnpm install
```

---

### Prisma Client Version Mismatch

```
Package @prisma/client can't be external
The package resolves to a different version when requested from 
the project directory (5.22.0) compared to the package requested
 from the importing module (6.19.1).
```

**Cause:** Different `@prisma/client` versions in different packages

**Solution:** Use SAME version everywhere:

```json
// packages/database/package.json
{ "dependencies": { "@prisma/client": "6.14.0" } }

// apps/main/package.json
{ "dependencies": { "@prisma/client": "6.14.0" } }

// apps/admin/package.json  
{ "dependencies": { "@prisma/client": "6.14.0" } }
```

---

### @prisma/client Can't Be External

```
Package @prisma/client can't be external
The request @prisma/client matches serverExternalPackages
The request could not be resolved by Node.js from the project directory.
Try to install it into the project directory
```

**Cause:** `@prisma/client` not in app's dependencies

**Solution:** Add to each app:

```json
// apps/main/package.json
{
  "dependencies": {
    "@repo/database": "workspace:*",
    "@prisma/client": "6.14.0"  // Add this!
  }
}
```

---

### Environment Variable Not Found

```
error: Environment variable not found: DATABASE_URL
```

**Solution 1:** Create `.env` file:

```bash
# packages/database/.env
DATABASE_URL="postgresql://user:password@localhost:5432/mydb"
```

**Solution 2:** For Vercel, add env vars in dashboard

**Solution 3:** Add to turbo.json:

```json
{
  "tasks": {
    "build": {
      "env": ["DATABASE_URL", "DIRECT_URL"]
    }
  }
}
```

---

## Turbo Build Errors

### Task Not Found in turbo.json

```
x Could not find "main#generate" in root turbo.json or "generate" in package
   ,-[turbo.json:8:5]
 7 |                 "^build",
 8 |                 "generate"
   :                 ^^^^^^^^^^
 9 |             ],
```

**Cause:** Using `"generate"` in dependsOn but task not defined properly

**Solution:** 

1. Define task in turbo.json:
```json
{
  "tasks": {
    "generate": {
      "cache": false,
      "inputs": ["prisma/schema.prisma"],
      "outputs": ["../../node_modules/.prisma/client/**"]
    }
  }
}
```

2. Ensure package has the script:
```json
// packages/database/package.json
{
  "scripts": {
    "generate": "prisma generate"
  }
}
```

3. Use `^generate` (with caret) for dependencies:
```json
{
  "tasks": {
    "build": {
      "dependsOn": ["^generate", "^build"]
    }
  }
}
```

---

### Cache Miss Every Time

**Cause:** Inputs or outputs not configured

**Solution:**
```json
{
  "tasks": {
    "build": {
      "inputs": ["$TURBO_DEFAULT$", ".env*"],
      "outputs": [".next/**", "!.next/cache/**"]
    }
  }
}
```

---

## Production & Vercel Errors

### Build Fails on Vercel - Missing Dependencies

```
Error: Cannot find module '@repo/ui'
```

**Cause:** Vercel not using correct install command

**Solution:** Set in Vercel dashboard:
- **Install Command:** `pnpm install`
- **Build Command:** `cd ../.. && pnpm turbo run build --filter=main`

---

### Build Fails - Wrong Working Directory

```
Error: Could not find a production build
```

**Solution:** Set correct root directory in Vercel:
- **Root Directory:** `apps/main` (or leave empty for monorepo root)

---

### TypeScript Errors Only in Production

```
Type error: Property 'X' does not exist on type 'Y'
```

**Cause:** Strict mode differences or missing generated types

**Solution:**
1. Run build locally first to catch errors:
   ```bash
   pnpm build
   ```

2. Ensure Prisma types are generated:
   ```bash
   pnpm --filter @repo/database generate
   ```

---

## Quick Diagnosis Flowchart

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      ERROR DIAGNOSIS FLOWCHART                          │
└─────────────────────────────────────────────────────────────────────────┘

  Error Message
       │
       ├─── Contains "FETCH_404" or "not in registry"
       │         └─── Change "*" to "workspace:*" in package.json
       │
       ├─── Contains "Module not found"
       │         ├─── Check exports in package.json
       │         ├─── Check file exists at path
       │         └─── Check import path matches export
       │
       ├─── Contains "prisma" or "schema"
       │         ├─── Add prisma.schema to root package.json
       │         ├─── Run pnpm --filter @repo/database generate
       │         └─── Check @prisma/client versions match
       │
       ├─── Contains "turbo" or "task not found"
       │         ├─── Define task in turbo.json
       │         └─── Add script to package.json
       │
       └─── Styling not working
                 ├─── Import globals.css in layout.tsx
                 ├─── Check postcss.config.mjs exists
                 └─── Check Tailwind installed in app
```

---

## Complete Checklist

### Before Deploying to Production

- [ ] All packages use `"workspace:*"` for local dependencies
- [ ] `@prisma/client` versions match across all packages
- [ ] Root package.json has `prisma.schema` configured
- [ ] Root package.json has `postinstall` script for Prisma
- [ ] `turbo.json` has `generate` task defined
- [ ] `turbo.json` build depends on `^generate`
- [ ] All apps have `postcss.config.mjs`
- [ ] All apps import global CSS in layout
- [ ] shadcn component imports use `@repo/ui/lib/utils`
- [ ] Environment variables configured in Vercel

---

## Related Documentation

- [Part 1: Turborepo Setup](./01-turborepo-setup.md)
- [Part 2: Tailwind + shadcn/ui](./02-tailwind-shadcn-setup.md)
- [Part 3: Prisma + PostgreSQL](./03-prisma-database-setup.md)
