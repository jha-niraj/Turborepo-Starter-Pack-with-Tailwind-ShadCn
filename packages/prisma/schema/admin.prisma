enum AdminRole {
    SUPER_ADMIN
    CONTENT_ADMIN
    FINANCE_ADMIN
    COMMUNITY_ADMIN
    MODULE_MANAGER
    VIEWER
}

enum AdminStatus {
    ACTIVE
    INACTIVE
    SUSPENDED
}

enum AdminInviteStatus {
    PENDING
    USED
    EXPIRED
    REVOKED
}

// Admin Access Control - Links to existing User model
model AdminAccess {
    id              String          @id @default(cuid())

    userId          String          @unique
    user            User            @relation("UserAdminAccess", fields: [userId], references: [id], onDelete: Cascade)
    
    adminRole       AdminRole       @default(MODULE_MANAGER)
    status          AdminStatus     @default(ACTIVE)
    
    // Module-level permissions (JSON for flexibility)
    // Format: { "users": ["read", "write"], "credits": ["read"], ... }
    permissions     Json            @default("{}")
    
    // Access tracking
    lastLoginAt     DateTime?
    loginCount      Int             @default(0)
    
    // Invitation info
    invitedBy       String?      
    inviteCode      String?        
    
    hashedPassword  String?
    
    accessCode      String?
    accessCodeExpiry DateTime?
    
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    
    // Relations
    invitations     AdminInvitation[] @relation("InvitedByAdmin")
    auditLogs       AdminAuditLog[]   @relation("AdminAuditLogs")
    
    @@index([adminRole])
    @@index([status])
    @@index([userId])
}

// Admin Invitation Codes
model AdminInvitation {
    id              String              @id @default(cuid())
    
    // Unique invitation code
    code            String              @unique @default(cuid())
    
    // Invitee info
    email           String              // Email to send invitation to
    name            String?             // Optional name
    
    // Role & Permissions for this invite
    adminRole       AdminRole
    permissions     Json                @default("{}") // Pre-defined permissions
    
    // Status tracking
    status          AdminInviteStatus   @default(PENDING)
    usedBy          String?             // userId who used this
    usedAt          DateTime?
    
    // Expiry
    expiresAt       DateTime            // Invite expiry (default 7 days)
    
    // Creator
    createdById     String
    createdBy       AdminAccess         @relation("InvitedByAdmin", fields: [createdById], references: [id], onDelete: Cascade)
    
    createdAt       DateTime            @default(now())
    
    @@index([code])
    @@index([email])
    @@index([status])
    @@index([expiresAt])
    @@index([createdById])
}

// Admin Activity Log (Audit Trail)
model AdminAuditLog {
    id              String          @id @default(cuid())
    
    adminId         String
    admin           AdminAccess     @relation("AdminAuditLogs", fields: [adminId], references: [id], onDelete: Cascade)
    
    // Action details
    action          String          // "CREATE", "UPDATE", "DELETE", "VIEW", "LOGIN", "LOGOUT"
    module          String          // "users", "credits", "projects", "system"
    resourceType    String?         // "User", "CreditTransaction", etc.
    resourceId      String?         // ID of affected resource
    
    // Details
    description     String?         // Human-readable description
    changes         Json?           // { before: {}, after: {} }
    metadata        Json?           // Additional context
    
    // Request info
    ipAddress       String?
    userAgent       String?
    
    createdAt       DateTime        @default(now())
    
    @@index([adminId])
    @@index([module])
    @@index([action])
    @@index([createdAt])
    @@index([resourceType, resourceId])
}

// Admin Dashboard Stats Cache (for performance)
model AdminDashboardStats {
    id              String          @id @default(cuid())
    
    // Stats type
    statType        String          @unique // "overview", "users", "credits", "projects"
    
    // Cached data
    data            Json
    
    // Last updated
    lastUpdatedAt   DateTime        @default(now())
    
    @@index([statType])
    @@index([lastUpdatedAt])
}

// Admin Notifications
model AdminNotification {
    id              String          @id @default(cuid())
    
    adminId         String?         // Null = broadcast to all admins
    
    // Notification content
    title           String
    message         String          @db.Text
    type            String          @default("info") // "info", "warning", "error", "success"
    
    // Action
    actionUrl       String?
    actionLabel     String?
    
    // Status
    isRead          Boolean         @default(false)
    readAt          DateTime?
    
    // Metadata
    metadata        Json?
    
    createdAt       DateTime        @default(now())
    
    @@index([adminId])
    @@index([isRead])
    @@index([createdAt])
}

// System Settings (Admin configurable)
model AdminSystemSettings {
    id              String          @id @default(cuid())
    
    key             String          @unique
    value           Json
    description     String?
    
    // Who last modified
    lastModifiedBy  String?
    
    createdAt       DateTime        @default(now())
    updatedAt       DateTime        @updatedAt
    
    @@index([key])
}